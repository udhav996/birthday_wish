<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Birthday Wish</title>
<style>
  * {
    box-sizing: border-box;
  }

  body {
    background-color: black;
    color: #e8efe8;
    font-family: monospace;
    overflow: hidden;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    margin: 0;
    padding: 10px;
  }

  #ascii-container {
    max-height: calc(100vh - 20px);
    max-width: calc(100vw - 20px);
    overflow: hidden;
    text-align: center;
    position: relative;
    width: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  #ascii-wrapper {
    display: block;
    white-space: pre;
    transition: transform 0.3s ease;
    font-size: clamp(4px, 1.2vw, 8px);
    line-height: 1.0;
    font-family: 'Courier New', Courier, monospace;
    max-width: 100%;
    overflow-x: hidden;
    text-align: left;
    letter-spacing: 0;
  }

  #ascii-text {
    margin: 0;
    line-height: 1.0;
    white-space: pre;
    max-width: none;
    font-family: 'Courier New', Courier, monospace;
    letter-spacing: 0;
  }

  #cursor {
    display: inline-block;
    background-color: #eef3ee;
    width: clamp(4px, 1vw, 8px);
    height: clamp(8px, 2vw, 16px);
    vertical-align: bottom;
    animation: blink 0.6s steps(1) infinite;
  }

  @keyframes blink {
    0%, 50% { opacity: 1; }
    51%, 100% { opacity: 0; }
  }

  /* Responsive image card */
  #image-card {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: clamp(120px, 40vw, 250px);
    height: clamp(160px, 50vw, 320px);
    background: white;
    overflow: hidden;
    box-shadow: 0 0 15px rgba(0,0,0,0.4);
    border-radius: 8px;
    opacity: 0;
    transition: opacity 1s ease;
    pointer-events: none;
    display: block;
    z-index: 10;
  }

  #final-image {
    display: block;
    height: 100%;
    width: 100%;
    object-fit: cover;
    user-select: none;
  }

  #image-mask {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: white;
    transition: height 3s ease;
    pointer-events: none;
    z-index: 2;
  }

  #sparkles {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    pointer-events: none;
    overflow: visible;
    z-index: 0;
  }

  .sparkle {
    position: absolute;
    border-radius: 50%;
    opacity: 0.9;
    animation-name: sparkleUp;
    animation-timing-function: linear;
    animation-iteration-count: infinite;
    filter: drop-shadow(0 0 3px);
  }

  @keyframes sparkleUp {
    0% {
      transform: translateY(0) scale(1);
      opacity: 1;
    }
    100% {
      transform: translateY(-200px) scale(0.3);
      opacity: 0;
    }
  }
  
  /* The music control button styling is removed as the button is no longer in the HTML */

  /* Mobile optimizations */
  @media (max-width: 768px) {
    body {
      padding: 2px;
    }
    
    #ascii-wrapper {
      font-size: clamp(3px, 1.8vw, 6px);
      line-height: 1.0;
      transform-origin: top center;
    }
    
    #ascii-text {
      line-height: 1.0;
    }
    
    #image-card {
      width: clamp(100px, 60vw, 200px);
      height: clamp(130px, 75vw, 260px);
    }
    
    #cursor {
      width: clamp(2px, 1vw, 4px);
      height: clamp(4px, 2vw, 8px);
    }
  }

  /* Tablet optimizations */
  @media (min-width: 769px) and (max-width: 1024px) {
    #ascii-wrapper {
      font-size: clamp(5px, 1.5vw, 8px);
      line-height: 1.0;
    }
    
    #image-card {
      width: clamp(180px, 35vw, 280px);
      height: clamp(230px, 45vw, 350px);
    }
  }

  /* Large screen optimizations */
  @media (min-width: 1025px) {
    #ascii-wrapper {
      font-size: clamp(6px, 1.0vw, 10px);
      line-height: 1.0;
    }
    
    #image-card {
      width: clamp(250px, 30vw, 300px);
      height: clamp(320px, 40vw, 400px);
    }
  }

  /* Extra small screens */
  @media (max-width: 480px) {
    #ascii-wrapper {
      font-size: clamp(2px, 2vw, 4px);
      line-height: 0.95;
      transform: scale(0.8);
      transform-origin: top center;
    }
    
    #image-card {
      width: clamp(80px, 70vw, 150px);
      height: clamp(100px, 85vw, 200px);
    }
    
    body {
      padding: 1px;
    }
  }

  /* Landscape mobile and very short screens */
  @media (max-height: 500px) {
    #ascii-wrapper {
      font-size: clamp(2px, 1.5vw, 4px);
      line-height: 0.9;
      transform: scale(0.7);
      transform-origin: top center;
    }
    
    #image-card {
      width: clamp(60px, 20vw, 120px);
      height: clamp(80px, 25vw, 160px);
    }
  }

  /* Portrait very tall screens */
  @media (min-height: 800px) and (max-width: 480px) {
    #ascii-wrapper {
      font-size: clamp(3px, 1.5vw, 5px);
      line-height: 1.0;
    }
    
    #image-card {
      width: clamp(120px, 50vw, 180px);
      height: clamp(150px, 65vw, 230px);
    }
  }
</style>
</head>
<body>

<div id="sparkles"></div>

<div id="ascii-container">
  <div id="ascii-wrapper">
    <pre id="ascii-text"></pre><span id="cursor"></span>
  </div>

  <div id="image-card">
    <img id="final-image" src="design2.jpg" alt="Sir's Sketch" />
    <div id="image-mask"></div>
  </div>
</div>

<script>
const asciiCake = String.raw`
               ¶        ¶        ¶
              ¶¶S      ¶SS      ¶SS
             ¶¶¶¶     ¶SS¶     ¶SS¶
              ¶¶       ¶¶       ¶¶
             ¶¶¶¶     ¶¶¶¶     ¶¶¶¶
             ¶__¶     ¶__¶     ¶__¶
             ¶__¶     ¶__¶     ¶__¶
             ¶__¶     ¶__¶     ¶__¶
             ¶__¶     ¶__¶     ¶__¶
             ¶¶¶__¶¶¶¶¶¶¶¶__¶¶¶¶¶¶¶¶__¶
         ¶¶¶¶¶¶__¶11111¶__¶11111¶__¶¶¶¶
      ¶¶¶1111¶__¶11111¶__¶11111¶__¶11¶¶¶¶
     ¶¶111$11¶¶¶¶11111¶__¶11111¶¶¶¶11$11¶¶¶
    ¶¶111$$$$11111$111¶¶¶¶11$1111111$$$$11¶¶
    ¶¶¶¶111$11111$$$$111111$$$$1111111$11¶¶¶
   ¶__¶¶¶¶¶¶¶¶¶1111$111111111$1111111¶¶¶¶¶_¶
 ¶¶______¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶____¶¶¶
 ¶¶¶¶_____§§________________________§§__¶¶11¶¶
 ¶¶11¶¶__§§_§§___§§_____§§____§§___§§_§§_¶¶111¶
 ¶111¶¶¶___§§___§§_§§__§§_§§_§§_§§___§§_¶¶¶111¶
 ¶1111¶¶¶¶________§§_____§§____§§_____¶¶¶¶111¶¶
 ¶¶¶¶111¶¶¶¶¶¶¶¶¶¶¶¶________¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶11¶¶¶¶
   ¶¶¶¶¶11111111¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶11111111¶¶¶
    ¶¶¶11111111111111111111111111111111111¶¶
     ¶¶¶¶111¶¶¶¶11111111¶¶11111111¶¶¶¶1111¶¶
        ¶¶¶¶¶¶¶¶¶111¶¶¶¶¶¶¶¶1111¶¶¶_¶¶¶¶¶¶
                ¶¶¶¶¶¶¶¶___¶¶¶¶¶¶¶¶
`;

const asciiText = String.raw` __    __                                                _______   __             __      __              __                                               
|  \  |  \                                              |       \ |  \           |  \    |  \            |  \                                              
| $$  | $$  ______    ______    ______   __    __       | $$$$$$$\ \$$  ______  _| $$_   | $$____    ____| $$  ______   __    __                           
| $$__| $$ |      \  /      \  /      \ |  \  |  \      | $$__/ $$|  \ /      \|   $$ \  | $$    \  /      $$ |      \ |  \  |  \                          
| $$    $$  \$$$$$$\|  $$$$$$\|  $$$$$$\| $$  | $$      | $$    $$| $$|  $$$$$$\\$$$$$$  | $$$$$$$\|  $$$$$$$  \$$$$$$\| $$  | $$                          
| $$$$$$$$ /      $$| $$  | $$| $$  | $$| $$  | $$      | $$$$$$$\| $$| $$   \$$ | $$ __ | $$  | $$| $$  | $$ /      $$| $$  | $$                          
| $$  | $$|  $$$$$$$| $$__/ $$| $$__/ $$| $$__/ $$      | $$__/ $$| $$| $$       | $$|  \| $$  | $$| $$__| $$|  $$$$$$$| $$__/ $$                          
| $$  | $$ \$$    $$| $$    $$| $$    $$ \$$    $$      | $$    $$| $$| $$        \$$  $$| $$  | $$ \$$    $$ \$$    $$ \$$    $$                          
 \$$   \$$  \$$$$$$$| $$$$$$$ | $$$$$$$  _\$$$$$$$       \$$$$$$$  \$$ \$$         \$$$$  \$$   \$$  \$$$$$$$  \$$$$$$$ _\$$$$$$$                          
                    | $$      | $$      |  \__| $$                                                                     |  \__| $$                          
                    | $$      | $$       \$$    $$                                                                      \$$    $$                          
                     \$$       \$$        \$$$$$$                                                                        \$$$$$$                          
 ________                                                                                                                                                  
|        \                                                                                                                                                 
 \$$$$$$$$______                                                                                                                                           
   | $$  /      \                                                                                                                                         
   | $$ |  $$$$$$\                                                                                                                                        
   | $$ | $$  | $$                                                                                                                                        
   | $$ | $$__/ $$                                                                                                                                        
   | $$  \$$    $$                                                                                                                                        
    \$$   \$$$$$$                                                                                                                                         
                                                                                                                                                          
                                                                                                                                                          
 _______                                       __  __        __       __                                                        __                  __  __
|       \                                     |  \|  \      |  \     /  \                                                      |  \                |  \|  \
| $$$$$$$\  ______    ______    ______        | $$| $$      | $$\   /  $$  ______   _______    ______       __         _______  \$$  ______        | $$| $$
| $$  | $$ /      \  |      \  /      \       | $$| $$      | $$$\ /  $$$ |      \ |       \  /      \     |  \       /       \|  \ /      \       | $$| $$
| $$  | $$|  $$$$$$\  \$$$$$$\|  $$$$$$\       \$$ \$$      | $$$$\  $$$$  \$$$$$$\| $$$$$$$\|  $$$$$$\     \$$      |  $$$$$$$| $$|  $$$$$$\       \$$ \$$
| $$  | $$| $$    $$ /      $$| $$   \$$                    | $$\$$ $$ $$ /      $$| $$  | $$| $$  | $$    |  \       \$$    \ | $$| $$   \$$             
| $$__/ $$| $$$$$$$$|  $$$$$$$| $$                          | $$ \$$$| $$|  $$$$$$$| $$  | $$| $$__/ $$    | $$       _\$$$$$$\| $$| $$                   
| $$    $$ \$$     \ \$$    $$| $$                          | $$  \$ | $$ \$$    $$| $$  | $$ \$$    $$    | $$      |       $$| $$| $$                   
 \$$$$$$$   \$$$$$$$  \$$$$$$$ \$$                           \$$      \$$  \$$$$$$$ \$$   \$$  \$$$$$$__   | $$       \$$$$$$$  \$$ \$$                   
                                                                                                     |  \__/ $$                                          
                                                                                                      \$$    $$                                          
                                                                                                       \$$$$$$                                          
`;

const asciiArray = (asciiCake + "\n\n" + asciiText).split("\n");
const asciiElement = document.getElementById("ascii-text");
const cursor = document.getElementById("cursor");
const finalImage = document.getElementById("final-image");
const imageCard = document.getElementById("image-card");
const imageMask = document.getElementById("image-mask");
const asciiWrapper = document.getElementById("ascii-wrapper");
const asciiContainer = document.getElementById("ascii-container");

let currentLine = 0;
let audioElement;
let audioPlayAttempted = false; // New flag to track play attempt

imageMask.style.height = "100%";

// Birthday song notes (Happy Birthday to You) - kept as a backup
const birthdayMelody = [
  {note: 264, duration: 0.5}, // C4
  {note: 264, duration: 0.5}, // C4
  {note: 297, duration: 1},   // D4
  {note: 264, duration: 1},   // C4
  {note: 352, duration: 1},   // F4
  {note: 330, duration: 2},   // E4
  
  {note: 264, duration: 0.5}, // C4
  {note: 264, duration: 0.5}, // C4
  {note: 297, duration: 1},   // D4
  {note: 264, duration: 1},   // C4
  {note: 396, duration: 1},   // G4
  {note: 352, duration: 2},   // F4
  
  {note: 264, duration: 0.5}, // C4
  {note: 264, duration: 0.5}, // C4
  {note: 528, duration: 1},   // C5
  {note: 440, duration: 1},   // A4
  {note: 352, duration: 1},   // F4
  {note: 330, duration: 1},   // E4
  {note: 297, duration: 2},   // D4
  
  {note: 466, duration: 0.5}, // Bb4
  {note: 466, duration: 0.5}, // Bb4
  {note: 440, duration: 1},   // A4
  {note: 352, duration: 1},   // F4
  {note: 396, duration: 1},   // G4
  {note: 352, duration: 2}    // F4
];

// Removed playBirthdaySong and playCustomSong simplification to only one function
function attemptToPlayAudio() {
  if (audioPlayAttempted) return; // Prevent multiple attempts after the first one

  if (!audioElement) {
    audioElement = new Audio('birthday_song.mp3'); // Replace with your file name
    audioElement.loop = true;
    audioElement.volume = 0.7;
  }
  
  // Attempt to play the audio
  audioElement.play().then(() => {
    // Autoplay worked!
    console.log('Audio played successfully on load.');
    audioPlayAttempted = true;
  }).catch(e => {
    // Autoplay failed (browser blocked it)
    console.log('Audio play blocked. Waiting for user interaction or starting synthetic backup.');
    audioPlayAttempted = true; // Still set to true so we don't try to play on interaction if this is a strict browser
    
    // Fallback: If autoplay fails, we can add an event listener to play 
    // on the first user interaction (like a keypress or touch)
    document.addEventListener('click', resumeAudioContext, { once: true });
    document.addEventListener('keydown', resumeAudioContext, { once: true });
  });
}

// Function to handle audio resume on user interaction
function resumeAudioContext() {
    if (audioElement && audioElement.paused) {
        audioElement.play().catch(e => {
            console.log('Audio resume on interaction failed:', e);
        });
    }
}


function typeCharWithSlide(char) {
  asciiElement.textContent += char;
  // Keep ASCII art centered and preserve formatting
  // No horizontal scrolling to avoid disturbing the ASCII layout
}

function typeLine(line, callback) {
  let charIndex = 0;
  function typeChar() {
    if (charIndex < line.length) {
      typeCharWithSlide(line.charAt(charIndex));
      charIndex++;
      setTimeout(typeChar, 0); // Much faster typing 
    } else {
      asciiElement.textContent += "\n";
      asciiWrapper.style.transform = "translateX(0)";
      callback();
    }
  }
  typeChar();
}

function typeAllLines() {
  if (currentLine < asciiArray.length) {
    typeLine(asciiArray[currentLine], () => {
      currentLine++;
      const maxLines = window.innerHeight < 400 ? 15 : 
                      window.innerHeight < 600 ? 25 :
                      window.innerHeight < 800 ? 35 : 45;
      
      const totalLines = asciiElement.textContent.split("\n").length;
      if (totalLines > maxLines && currentLine > 27) {
        asciiElement.textContent = asciiElement.textContent
          .split("\n")
          .slice(1)
          .join("\n");
      }
      typeAllLines();
    });
  } else {
    // === START OF THE END SEQUENCE ===
    cursor.style.display = "none";
    imageCard.style.opacity = 1;
    
    setTimeout(() => {
      imageMask.style.height = "0%";
      
      
      setTimeout(() => {
          if (audioElement) {
              audioElement.pause();
              audioElement.currentTime = 0; // Reset to the start of the song
              console.log('Birthday song paused and reset.');
          }
      }, 3500); 
      
    }, 500); 
  }
}


setTimeout(() => {
  attemptToPlayAudio(); 
}, 100);

typeAllLines();

// Sparkles animation with device-responsive count
const sparklesContainer = document.getElementById("sparkles");
const getSparkleCount = () => {
  if (window.innerWidth < 480) return 15;
  if (window.innerWidth < 768) return 25;
  if (window.innerWidth < 1024) return 40;
  return 60;
};

let sparkleCount = getSparkleCount();
const sparkleColors = [
  "#FF6B6B",  // Red
  "#FFD93D",  // Yellow
  "#6BCB77",  // Green
  "#4D96FF",  // Blue
  "#9D4EDD",  // Purple
  "#FF61A6"   // Pink
];

function createSparkle() {
  const sparkle = document.createElement("div");
  sparkle.classList.add("sparkle");
  const baseSize = window.innerWidth < 480 ? 2 : window.innerWidth < 768 ? 3 : 4;
  const size = Math.random() * baseSize + baseSize;
  sparkle.style.width = size + "px";
  sparkle.style.height = size + "px";
  sparkle.style.background = sparkleColors[Math.floor(Math.random() * sparkleColors.length)];
  sparkle.style.left = Math.random() * window.innerWidth + "px";
  sparkle.style.top = Math.random() * window.innerHeight + "px";
  sparkle.style.animationDuration = (Math.random() * 3 + 2) + "s";
  sparklesContainer.appendChild(sparkle);
  sparkle.addEventListener("animationend", () => {
    if (sparkle.parentNode) {
      sparkle.remove();
      createSparkle();
    }
  });
}

// Initialize sparkles
for (let i = 0; i < sparkleCount; i++) {
  createSparkle();
}

// Handle orientation changes and window resize
let resizeTimer;
window.addEventListener('resize', () => {
  clearTimeout(resizeTimer);
  resizeTimer = setTimeout(() => {
    // Update sparkles count based on new screen size
    const newSparkleCount = getSparkleCount();
    const currentSparkles = sparklesContainer.children.length;
    
    if (currentSparkles < newSparkleCount) {
      for (let i = currentSparkles; i < newSparkleCount; i++) {
        createSparkle();
      }
    } else if (currentSparkles > newSparkleCount) {
      // Remove excess sparkles
      const excess = currentSparkles - newSparkleCount;
      for (let i = 0; i < excess; i++) {
        const lastSparkle = sparklesContainer.lastElementChild;
        if (lastSparkle) lastSparkle.remove();
      }
    }
    
    sparkleCount = newSparkleCount;
  }, 250);
});

window.addEventListener('orientationchange', () => {
  setTimeout(() => {
    // Recalculate layout after orientation change
    const newSparkleCount = getSparkleCount();
    sparkleCount = newSparkleCount;
    
    // Clear and recreate sparkles for new orientation
    while (sparklesContainer.firstChild) {
      sparklesContainer.removeChild(sparklesContainer.firstChild);
    }
    
    for (let i = 0; i < sparkleCount; i++) {
      createSparkle();
    }
  }, 500);
});
</script>

</body>
</html>
